\listfiles
% !TEX TS-program = xelatex
% !TEX encoding = UTF-8

% arara: lualatex
% arara: lualatex
% arara: makeglossaries
% arara: lualatex 

\documentclass{scrbook}
% I use KOMA-script as I find it gives much easier control than a mishmash of different packages.
%% KOMA options
\KOMAoption{appendixprefix}{false}
\KOMAoption{chapterprefix}{false}
\KOMAoption{cleardoublepage}{empty}
\KOMAoption{DIV}{10}
\KOMAoption{draft}{false}
\KOMAoption{fontsize}{12pt}
\KOMAoption{headings}{big}
\KOMAoption{open}{right}
\KOMAoption{paper}{a4}
\KOMAoption{parskip}{half}
\KOMAoption{toc}{indent}
\KOMAoption{twoside}{semi}
\KOMAoption{captions}{signature}
%\setlength{\parindent}{1em}

% KOMA is complaining and apparently this fixes it =/
\usepackage{scrhack}
\usepackage{listings}

% Split document into multiple parts
\usepackage{subfiles}

% e-TeX tools
\usepackage{etoolbox}

%% Typography Settings
% Load fonts for XeTeX, including support for Unicode etc.
% Mathspec makes it possible to redefine *all* the fonts used for math stuff,
% however, it contains a stupid bug in dependency checking, see
% <http://tex.stackexchange.com/a/85700/60686>.
% \usepackage{mathspec}
% \makeatletter % undo the wrong changes made by mathspec
% \let\RequirePackage\original@RequirePackage
% \let\usepackage\RequirePackage
% \makeatother

\usepackage{fontspec}
\defaultfontfeatures{Mapping=tex-text}

\usepackage{microtype}

\setmainfont{Linux Libertine O}[
	Numbers=Uppercase,
]

% \setmainfont{Brill}[
%   Numbers=Uppercase,
% ]

% \setsansfont{Linux Biolinum O}[
% 	Numbers=Uppercase,
% 	Scale=MatchLowercase,
% ]

\setsansfont{Fira Sans}[
	% Ligatures=TeX,
	Numbers=Uppercase,
	Scale=MatchLowercase,
	BoldFont={* SemiBold},
]

\setmonofont{Fira Mono}[
	Ligatures=TeX,
	Scale=MatchLowercase,
]

% \setmathsfont(Digits,Latin,Greek)[
% 	Ligatures=TeX,
% 	Numbers=Lowercase,
% ]{Junicode}

% Fontawesome icons
\usepackage{fontawesome}

%% Metadata
\title{Qevesa Grammar}
\author{Robbie Smith}
\date{Working Draft: \today}

\makeatletter
\let\thetitle\@title
\let\theauthor\@author
\let\thedate\@date
\makeatother

\usepackage{hyperref}
\hypersetup{
  pdfauthor={\theauthor},
  pdftitle={\thetitle},
  colorlinks=false,
  hidelinks}
\usepackage[all]{hypcap}

%% Language settings
\usepackage{polyglossia}
\setdefaultlanguage[variant=australian]{english}

%% This is meant to be a DRAFT
% \usepackage{draftwatermark}
% \SetWatermarkText{\textsf{DRAFT}}
\providecommand{\Tbw}{\emph{To be written\dots}}
\providecommand{\tbw}{\emph{to be written\dots}}

% \setkomafont{pagehead}{\rmitfont\color{rmitred}\selectfont}
% \setkomafont{pagenumber}{\rmitfont\color{black}\selectfont}

\RequirePackage[automark,nouppercase]{scrpage2}
\pagestyle{scrheadings}
\clearscrheadfoot
\lehead{\thetitle}
\rohead{\leftmark}
\cfoot{\pagemark}
% \setheadsepline{0.5pt}


\setkomafont{title}{\Huge}
\setkomafont{titlehead}{\Large}
\setkomafont{author}{\small\itshape}
\setkomafont{publishers}{\usefontofkomafont{author}}
\setkomafont{date}{\small}
\setkomafont{chapter}{\fontsize{30}{30}\bfseries\itshape}
\setkomafont{chapterentry}{\bfseries}
\setkomafont{section}{\LARGE\bfseries}
\setkomafont{subsection}{\Large\mdseries}
\setkomafont{subsubsection}{\large\mdseries\itshape}

%% Reduce space above the chapter head
\renewcommand*{\chapterheadstartvskip}{\vspace*{-\topskip}}

%% Switching the order of elements is easy now. Note that this needs to be uncommented to use the examples below
\renewcommand\chapterformat{%
  {\fontsize{96}{96}\upshape\selectfont\thechapter}}
  % {\fontsize{90}{90}\rmitfont\textcolor{rmitred}{\thechapter}}}
 
\newbox\chapternumberbox
\renewcommand\chapterlinesformat[3]{%
 \ifstr{#2}{}{
     \parbox[b]{\textwidth}{\raggedright#3}%
   }{%
   \savebox\chapternumberbox{\makebox[0pt][r]{\raisebox{36pt}{\makebox[0pt][r]{\rotatebox{90}{\large\scshape\chapapp}}\hspace{0.25ex}#2}}}%
     \parbox[b]{\dimexpr\textwidth-\wd\chapternumberbox\relax}{\raggedright#3}%
     \usebox\chapternumberbox%
 }\par\nobreak
}

%\renewcommand*{\appendixmore}{
%  \renewcommand*{\chapterformat}{\appendixname~\thechapter\autodot\enskip}
%  \renewcommand*{\chaptermarkformat}{\appendixname~\thechapter\autodot\enskip}
%}

\renewcommand*{\tableformat}{\tablename~\thetable\autodot}
\renewcommand*{\captionformat}{~}

\usepackage{caption}
\captionsetup[subfigure]{font={md,small},labelfont={sf,small}}
\setkomafont{caption}{\small}
\setkomafont{captionlabel}{\upshape\bfseries\sffamily}
\usepackage{subfig}

\usepackage{enumitem}
\setlist{itemsep=1.5pt, parsep=1.5pt}


%% Table tricks
\usepackage{tableformat}
\usepackage{floatrow}

\renewcommand{\arraystretch}{1.25}
\renewcommand{\tabcolsep}{0.5em}
\newcommand{\tc}[1]{\renewcommand{\tabcolsep}{#1}}
\newcommand{\tnl}{\tabularnewline}

% Sideways pages
\usepackage{pdflscape}

%% Other settings
\hyphenpenalty=2500
\tolerance=500
\widowpenalty=1500
\clubpenalty=1500

% Glossaries for abbreviations
\usepackage[acronym,nomain,shortcuts,toc,section,xindy]{glossaries}
\usepackage{glossary-mcols}
\DeclareAcronymList{glossing}
%\DeclareAcronymList{other}

%\newglossarystyle{twocollist}{\glossarystyle{list}\BeforeBeginEnvironment{theglossary}{\begin{multicols*}{2}}\AfterEndEnvironment{theglossary}{\end{multicols*}}}

% Custom display style to match old abbreviations.tex
\setacronymstyle{sc-short-long}
\newglossary[alg]{glossing}{acr}{acn}{List of Glossing Abbreviations}
%\newglossary[alg]{other}{acr}{acn}{List of Other Abbreviations}
\setglossarystyle{mcolindex}
\renewcommand{\glsnamefont}[1]{\textnormal{\scshape #1}}
\renewcommand*{\glsgroupskip}{}
\renewcommand{\glspostdescription}{}

\loadglsentries[glossing]{glosses}
%\loadglsentries[other]{abbreviations}
\glsunsetall
\makeglossaries

%% Linguistics
\usepackage{gb5e}  %% gb5e is my improved version of gb4e
\let\eachwordone=\textit
\noautomath

\renewcommand{\sup}[1]{\textsuperscript{#1}}
\newcommand{\sub}[1]{\textsubscript{#1}}
\newcommand{\dec}{\textsubscript{10}}
\newcommand{\duo}{\textsubscript{12}}
\newcommand{\bs}{\textbackslash}
\newcommand{\tlde}{\textasciitilde}
% Shortcuts for IPA symbols
\newcommand{\suph}{\textsuperscript{h}}
\newcommand{\supj}{\textsuperscript{j}}
\newcommand{\supw}{\textsuperscript{w}}
\newcommand{\tsb}[1]{\textsubbridge{#1}}
% Special forms
\newcommand{\foreign}[1]{\textit{#1}}
\newcommand{\Q}[1]{\textit{#1}}
\newcommand{\Qt}[2]{\textit{#1} “#2”}

\usepackage[capitalise]{cleveref}

% Creative Commons licensing
\usepackage{ccicons}
%%% END PREAMBLE

\begin{document}

  \frontmatter
  \maketitle
  %\subfile{titlepage}
  \subfile{copyright}

  %\setcounter{secnumdepth}{-1}% Unnumbered chapters
  %\pagenumbering{roman}

  \tableofcontents

  % Uncomment when you add some figures
  %\listoffigures

  %\listoftables

  \subfile{preface}

  % \pagestyle{fancy}
  \mainmatter
  \setcounter{secnumdepth}{4}
  % Uncomment this when finished to place chapters on right pages.
  %\KOMAoptions{open=right}

  \subfile{background}

  \subfile{phonology}

  \subfile{morphological-typology}

  \subfile{verbal-morphology}

  \subfile{nominal-morphology}

  \subfile{adjectival-morphology}

  \subfile{numerals}

  \subfile{derivational-morphology}

  %\subfile{postpositions}

  %\subfile{constituent-order-typology}

  %\subfile{verbal-syntax}

  %\subfile{nominal-syntax}

  %\subfile{registers}

  %\subfile{valency}

  %\subfile{verbphrases}

  %\subfile{pragmatics}

  %\subfile{clauses}

  % APPENDICES
  \appendix

  \subfile{appendix-history}

  %\renewcommand{\thechapter}{\Alph{chapter}}
  %\subfile{appendix-noun-suffixes}
  % \glsaddall
%  \printglossary[type=glossing]
%  \printglossary[type=other]
  % \printglossaries
  %\backmatter

\end{document}
