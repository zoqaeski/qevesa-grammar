%\listfiles
% !TEX TS-program = xelatex
% !TEX encoding = UTF-8

%%%%%%%%%%%%%%%%%%%
% Test using memoir
%%%%%%%%%%%%%%%%%%%
%\documentclass[a4paper,12pt,twoside,onecolumn,openright,draft,showtrims]{memoir}
%\settrimmedsize{297mm}{210mm}{*}
%\setlength{\trimtop}{0pt}
%\setlength{\trimedge}{\stockwidth}
%\addtolength{\trimedge}{-\paperwidth}
%\settypeblocksize{634pt}{448.13pt}{*}
%\setulmargins{4cm}{*}{*}
%\setlrmargins{*}{*}{1.5}
%\setmarginnotes{17pt}{51pt}{\onelineskip}
%\setheadfoot{\onelineskip}{2\onelineskip}
%\setheaderspaces{*}{2\onelineskip}{*}
%\checkandfixthelayout

\documentclass{scrreprt}
% I use KOMA-script as I find it gives much easier control than a mishmash of different packages.
%% KOMA options
\KOMAoptions{
  appendixprefix=false,
  chapterprefix=false,
  cleardoublepage=empty,
  DIV=13,
  draft=false,
  fontsize=12pt,
  headings=big,
  open=right,
  paper=a4,
  parskip=half,
  toc=flat,
  twoside=semi
}
%\setlength{\parindent}{1em}

%% Metadata
\title{Qevesa Grammar}
\author{Robbie Smith}
\date{Working Draft: \today}
\usepackage{hyperref}
\hypersetup{
  pdfauthor={Robbie Smith},
  pdftitle={Qevesa Grammar},
  pdfkeywords={},
  pdfsubject={Constructed Linguistics},
  pdfcreator={XeLaTeX},
  colorlinks=false,
  pdfborder={0 0 0 0}}
\usepackage[all]{hypcap}

%% Language settings
\usepackage{polyglossia}
\setdefaultlanguage[variant=australian]{english}

%% This is meant to be a DRAFT
%\usepackage{draftwatermark}
%\SetWatermarkText{\textsf{DRAFT}}
\providecommand{\ToBeWritten}{\emph{To be written\dots}}


% Grab the title of the document
\makeatletter
\let\mytitle\@title
\let\myauthor\@author
\let\mydate\@date
\makeatother

\usepackage[automark,nouppercase]{scrpage2}
\pagestyle{scrheadings}
\clearscrheadfoot
\lehead[]{\mytitle}
\rohead[]{\leftmark}
\cfoot[\pagemark]{\pagemark}
\renewcommand*{\headfont}{\itshape\scshape}% Will equal \scshape for most fonts
\renewcommand*{\chaptermarkformat}{\chapapp~\thechapter\autodot\enskip}

% Numbering and ... stuff
\usepackage{titlesec}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
\titlespacing{\section}{0pt}{1.25ex + 0.5ex - 0.25ex}{0.875ex + 0.25ex}
\titlespacing{\subsection}{0pt}{1.125ex + 0.375ex - 0.125ex}{0.875ex + 0.125ex}
\titlespacing{\subsubsection}{0pt}{1.0ex + 0.25ex - 0.125ex}{0.75ex + 0.125ex}
%\titlespacing{\paragraph}{0pt}{1.0ex + 0.125ex - 0.125ex}{0.75ex + 0.125ex}
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
  {1.0ex \@plus 0.125ex \@minus 0.125ex}%
  {0.75ex \@plus 0.125ex}%
  {\normalfont\normalsize\bfseries}}
\makeatother


\newenvironment{itemize*}
{\begin{itemize}
      \setlength{\itemindent}{0pt}
      \setlength{\itemsep}{1.25pt}
      \setlength{\parskip}{0.5pt}
      \setlength{\parsep}{0.5pt}}
    %\setlength{\leftmargin}{1.5em}
    {\end{itemize}}

\renewcommand*{\appendixmore}{
  \renewcommand*{\chapterformat}{\appendixname~\thechapter\autodot\enskip}
  \renewcommand*{\chaptermarkformat}{\appendixname~\thechapter\autodot\enskip}
}

\renewcommand*{\tableformat}{\tablename~\thetable\autodot}
\renewcommand*{\captionformat}{~}

\usepackage{subfiles}

%% Font settings
% If I want to use mathematics fonts I can use mathspec instead of fontspec and it will probably work.
\usepackage{fontspec}
\defaultfontfeatures{Mapping=tex-text}
\usepackage{xunicode}
\usepackage{xltxtra}
\setmainfont{Linux Libertine O}
\setromanfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\setmonofont[Scale=MatchLowercase]{DejaVu Sans Mono}
%\setmathfont{Linux Libertine O}

%% Underline capable (but not needed here
%\usepackage[normalem]{ulem}

\usepackage{enumitem}

%% Table tricks
\usepackage{array}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{tabularx}
\usepackage{xtab}
\usepackage[font=small,textfont=it,labelfont=up,format=hang,parskip=5pt]{caption,subfig}

\newcommand{\SetRowStyle}[1]{\gdef\RowStyle{#1}#1\ignorespaces}
\newcolumntype{f}{>{\global\let\RowStyle\relax}}
\newcolumntype{-}{>{\RowStyle}}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\renewcommand{\arraystretch}{1.25}
\renewcommand{\tabcolsep}{3pt}

%% Other settings
\hyphenpenalty=5000
\tolerance=500
\widowpenalty=1500
\clubpenalty=1500

%% Linguistics
%\usepackage{tipa}
%\usepackage{expex}
%\lingset{
%	exnosplitpenalty=300,
%	everygla=\it
%	%glstyle=wrap
%}
%% LaTeX fixes?
%\def\endex{\xe}
%\let\endpex=\endex

\usepackage{gb4e} % gb4e might be obsolete, not sure whether to replace with ExPex
\noautomath
\let\eachwordone=\textit

\renewcommand{\sup}[1]{\textsuperscript{#1}}
\providecommand{\sub}[1]{\textsubscript{#1}}

\providecommand{\dec}{\textsubscript{10}}
\providecommand{\subdec}{\textsubscript{10}}
\providecommand{\duo}{\textsubscript{12}}
\providecommand{\subduo}{\textsubscript{12}}

\providecommand{\bs}{\textbackslash}

% Shortcuts for IPA symbols
\providecommand{\superh}{\textsuperscript{h}}
\providecommand{\superj}{\textsuperscript{j}}
\providecommand{\superw}{\textsuperscript{w}}

%%% ENDÂ PREAMBLE

\begin{document}

  \maketitle
  %\frontmatter
  %\subfile{titlepage}

  \setcounter{secnumdepth}{-1}% Unnumbered chapters
  \pagenumbering{roman}

  \tableofcontents

  % Uncomment when you add some figures
  %\listoffigures

  \listoftables

  \subfile{preface}

  % \pagestyle{fancy}
  %\mainmatter
  \setcounter{secnumdepth}{4}
  % Uncomment this when finished to place chapters on right pages.
  %\KOMAoptions{open=right}

  \subfile{background}

  \subfile{phonology}

  \subfile{morphological-typology}

  \subfile{derivational-morphology}

  \subfile{verbal-morphology}

  \subfile{nominal-morphology}

  \subfile{adjectival-morphology}

  \subfile{numerals}

  %\subfile{postpositions}

  \subfile{constituent-order-typology}

  %\subfile{verbal-syntax}

  %\subfile{nominal-syntax}

  %\subfile{registers}

  %\subfile{valency}

  %\subfile{verbphrases}

  %\subfile{pragmatics}

  %\subfile{clauses}

  % APPENDICES
  \appendix
  %\renewcommand{\thechapter}{\Alph{chapter}}
  \subfile{abbreviations}
  %\backmatter

\end{document}
