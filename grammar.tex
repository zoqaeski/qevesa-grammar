\listfiles
% !TEX TS-program = xelatex
% !TEX encoding = UTF-8

\documentclass{scrreprt}
% I use KOMA-script as I find it gives much easier control than a mishmash of different packages.
%% KOMA options
\KOMAoption{appendixprefix}{false}
\KOMAoption{chapterprefix}{false}
\KOMAoption{cleardoublepage}{empty}
\KOMAoption{DIV}{12}
\KOMAoption{draft}{false}
\KOMAoption{fontsize}{12pt}
\KOMAoption{headings}{big}
\KOMAoption{open}{right}
\KOMAoption{paper}{a4}
\KOMAoption{parskip}{half}
\KOMAoption{toc}{flat}
\KOMAoption{twoside}{semi}
%\setlength{\parindent}{1em}

% KOMA is complaining and apparently this fixes it =/
\usepackage{scrhack}
\usepackage{listings}

% Split document into multiple parts
\usepackage{subfiles}

% e-TeX tools
\usepackage{etoolbox}

%% Metadata
\title{Qevesa Grammar}
\author{Robbie Smith}
\date{Working Draft: \today}

% Grab the title of the document
\makeatletter
\let\mytitle\@title
\let\myauthor\@author
\let\mydate\@date
\makeatother

\usepackage{hyperref}
\hypersetup{
  pdfauthor={\myauthor},
  pdftitle={\mytitle},
  pdfkeywords={},
  pdfsubject={Constructed Linguistics},
  pdfcreator={XeLaTeX},
  hidelinks=true}
\usepackage[all]{hypcap}

%% Language settings
\usepackage{polyglossia}
\setdefaultlanguage[variant=australian]{english}

%% This is meant to be a DRAFT
%\usepackage{draftwatermark}
%\SetWatermarkText{\textsf{DRAFT}}
\providecommand{\ToBeWritten}{\emph{To be written\dots}}

\usepackage[automark,nouppercase]{scrpage2}
\pagestyle{scrheadings}
\clearscrheadfoot
\lehead[]{\mytitle}
\rohead[]{\leftmark}
\cfoot[\pagemark]{\pagemark}
\renewcommand*{\headfont}{\itshape\scshape}% Will equal \scshape for most fonts
\renewcommand*{\chaptermarkformat}{\chapapp~\thechapter\autodot\enskip}

% Numbering and lists
\usepackage[compact]{titlesec}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
%\titlespacing{\section}{0pt}{1.25ex + 0.5ex - 0.25ex}{0.875ex + 0.25ex}
%\titlespacing{\subsection}{0pt}{1.125ex + 0.375ex - 0.125ex}{0.875ex + 0.125ex}
%\titlespacing{\subsubsection}{0pt}{1.0ex + 0.25ex - 0.125ex}{0.75ex + 0.125ex}
%\titlespacing{\paragraph}{0pt}{1.0ex + 0.125ex - 0.125ex}{0.75ex + 0.125ex}
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
  {1.0ex \@plus 0.125ex \@minus 0.125ex}%
  {0.75ex \@plus 0.125ex}%
  {\normalfont\normalsize\bfseries}}
\makeatother

\newenvironment{itemize*}{
  \begin{itemize}
    \setlength{\itemindent}{0pt}
    \setlength{\itemsep}{1.25pt}
    \setlength{\parskip}{0.5pt}
    \setlength{\parsep}{0.5pt}}
    %\setlength{\leftmargin}{1.5em}
{
  \end{itemize}
}

\renewcommand*{\appendixmore}{
  \renewcommand*{\chapterformat}{\appendixname~\thechapter\autodot\enskip}
  \renewcommand*{\chaptermarkformat}{\appendixname~\thechapter\autodot\enskip}
}

\renewcommand*{\tableformat}{\tablename~\thetable\autodot}
\renewcommand*{\captionformat}{~}


%% Font settings
% If I want to use mathematics fonts I can use mathspec instead of fontspec and it will probably work.
\usepackage{fontspec}
\defaultfontfeatures{Mapping=tex-text}
\usepackage{xunicode}
\usepackage{xltxtra}
\setmainfont{Linux Libertine O}
\setromanfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\setmonofont[Scale=MatchLowercase]{DejaVu Sans Mono}
%\setmathfont{Linux Libertine O}

% Allow me to use proper angle brackets
\usepackage{newunicodechar}
\newfontfamily\anglefont{FreeSerif}
\newunicodechar{⟨}{{\anglefont ⟨}}
\newunicodechar{⟩}{{\anglefont ⟩}}

%% Underline capable (but not needed here
%\usepackage[normalem]{ulem}
\usepackage{enumitem}

%% Table tricks
\usepackage{array}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage[font=small,textfont=it,labelfont=up,format=hang,parskip=5pt]{caption,subfig}
\usepackage{floatrow}

\newcommand{\SetRowStyle}[1]{\gdef\RowStyle{#1}#1\ignorespaces}
\newcolumntype{F}{>{\global\let\RowStyle\relax}}
\newcolumntype{f}{>{\RowStyle}X}
\newcolumntype{-}{>{\RowStyle}}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\renewcommand{\arraystretch}{1.25}
\renewcommand{\tabcolsep}{3pt}
\newcommand{\tnl}{\tabularnewline}

% Sideways pages
\usepackage{pdflscape}

%% Other settings
\hyphenpenalty=5000
\tolerance=500
\widowpenalty=1500
\clubpenalty=1500

% Glossaries for abbreviations
\usepackage[acronymlists={glossing},nomain,nonumberlist,numberedsection,toc,sanitize=none,section=chapter,smallcaps,shortcuts,xindy]{glossaries}

\newglossarystyle{twocollist}{\glossarystyle{list}\BeforeBeginEnvironment{theglossary}{\begin{multicols*}{2}}\AfterEndEnvironment{theglossary}{\end{multicols*}}}

% Custom display style to match old abbreviations.tex
\newglossary[alg]{glossing}{acr}{acn}{List of Glossing Abbreviations}
\glossarystyle{twocollist}
\renewcommand{\glsnamefont}[1]{\textnormal{\scshape #1}}
\renewcommand*{\glsgroupskip}{}
\renewcommand{\glspostdescription}{}
%\renewcommand{\acronymname}{List of Glossing Abbreviations}

%\setglossarysection{chapter}

\loadglsentries[glossing]{abbreviations-db}
\glsunsetall
\makeglossaries

%% Linguistics
%\usepackage{tipa}
%\usepackage{expex}
%\lingset{
%	exnosplitpenalty=300,
%	everygla=\it
%	%glstyle=wrap
%}
%% LaTeX fixes?
%\def\endex{\xe}
%\let\endpex=\endex

\usepackage{gb4e} % gb4e might be obsolete, not sure whether to replace with ExPex
\noautomath
\let\eachwordone=\textit

\renewcommand{\sup}[1]{\textsuperscript{#1}}
\newcommand{\sub}[1]{\textsubscript{#1}}
\newcommand{\dec}{\textsubscript{10}}
\newcommand{\subdec}{\textsubscript{10}}
\newcommand{\duo}{\textsubscript{12}}
\newcommand{\subduo}{\textsubscript{12}}
\newcommand{\ttwo}{\textturntwo}
\newcommand{\tthree}{\textturnthree}
\newcommand{\bs}{\textbackslash}
% Shortcuts for IPA symbols
\newcommand{\superh}{\textsuperscript{h}}
\newcommand{\superj}{\textsuperscript{j}}
\newcommand{\superw}{\textsuperscript{w}}
\newcommand{\tsb}[1]{\textsubbridge{#1}}
% Special forms
\newcommand{\foreign}[1]{\textit{#1}}
\newcommand{\qevesa}[1]{\textit{#1}}

\usepackage[capitalise]{cleveref}
%%% END PREAMBLE

\begin{document}

  \maketitle
  %\frontmatter
  %\subfile{titlepage}

  \setcounter{secnumdepth}{-1}% Unnumbered chapters
  \pagenumbering{roman}

  \tableofcontents

  % Uncomment when you add some figures
  %\listoffigures

  \listoftables

  \subfile{preface}

  % \pagestyle{fancy}
  %\mainmatter
  \setcounter{secnumdepth}{4}
  % Uncomment this when finished to place chapters on right pages.
  %\KOMAoptions{open=right}

  \subfile{background}

  \subfile{phonology}

  \subfile{morphological-typology}

  % TODO Split the derivational morphology chapter so that the verb forms goes
  % in Verbal Morphology, and the derivational processes get their own section
  % placed before syntax.
  %\subfile{derivational-morphology}

  \subfile{verbal-morphology}

  \subfile{nominal-morphology}

  \subfile{adjectival-morphology}

  \subfile{numerals}

  %\subfile{postpositions}

  \subfile{constituent-order-typology}

  %\subfile{verbal-syntax}

  %\subfile{nominal-syntax}

  %\subfile{registers}

  %\subfile{valency}

  %\subfile{verbphrases}

  %\subfile{pragmatics}

  %\subfile{clauses}

  % APPENDICES
  \appendix
  %\renewcommand{\thechapter}{\Alph{chapter}}
  \subfile{appendix-noun-suffixes}
  \glsaddall
  \printglossary[type=glossing]
  %\backmatter

\end{document}
